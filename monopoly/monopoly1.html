<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé© Monopoly Ultimate Banking - Digital</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
        }
        .main-container {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 15px;
            max-width: 1800px;
            margin: 0 auto;
        }
        .header {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            text-align: center;
            color: white;
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 5px; }
        .header p { font-size: 1rem; opacity: 0.95; }
        
        .board-wrapper { display: flex; justify-content: center; align-items: center; }
        .monopoly-board {
            background: #f0e68c;
            border: 8px solid #8b4513;
            border-radius: 4px;
            width: 500px;
            height: 500px;
            position: relative;
            display: grid;
            grid-template-columns: 60px repeat(9, 1fr) 60px;
            grid-template-rows: 60px repeat(9, 1fr) 60px;
            gap: 1px;
        }
        .board-space {
            border: 1px solid #999;
            padding: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.5rem;
            font-weight: 600;
            text-align: center;
            position: relative;
            background: white;
            cursor: pointer;
            overflow: hidden;
        }
        .board-space:hover { box-shadow: inset 0 0 5px rgba(0,0,0,0.2); }
        .corner-space { background: #8b4513; color: white; font-weight: 700; }
        .street-property { border-top: 12px solid; }
        .brown { border-top-color: #8b4513; }
        .lightblue { border-top-color: #87ceeb; }
        .pink { border-top-color: #ff69b4; }
        .orange { border-top-color: #ffa500; }
        .red { border-top-color: #dc143c; }
        .yellow { border-top-color: #ffd700; }
        .green { border-top-color: #228b22; }
        .darkblue { border-top-color: #00008b; color: white; }
        .railroad { background: #333; color: white; border-top-color: #000; }
        .utility { background: #ffb6c1; border-top-color: #ff69b4; }
        .event-space { background: #87ceeb; color: white; }
        .location-space { background: #ffd700; }
        
        .space-0 { grid-column: 1; grid-row: 11; } .space-1 { grid-column: 2; grid-row: 11; } .space-2 { grid-column: 3; grid-row: 11; } .space-3 { grid-column: 4; grid-row: 11; } .space-4 { grid-column: 5; grid-row: 11; } .space-5 { grid-column: 6; grid-row: 11; } .space-6 { grid-column: 7; grid-row: 11; } .space-7 { grid-column: 8; grid-row: 11; } .space-8 { grid-column: 9; grid-row: 11; } .space-9 { grid-column: 10; grid-row: 11; } .space-10 { grid-column: 11; grid-row: 11; }
        .space-11 { grid-column: 11; grid-row: 10; } .space-12 { grid-column: 11; grid-row: 9; } .space-13 { grid-column: 11; grid-row: 8; } .space-14 { grid-column: 11; grid-row: 7; } .space-15 { grid-column: 11; grid-row: 6; } .space-16 { grid-column: 11; grid-row: 5; } .space-17 { grid-column: 11; grid-row: 4; } .space-18 { grid-column: 11; grid-row: 3; } .space-19 { grid-column: 11; grid-row: 2; } .space-20 { grid-column: 11; grid-row: 1; }
        .space-21 { grid-column: 10; grid-row: 1; } .space-22 { grid-column: 9; grid-row: 1; } .space-23 { grid-column: 8; grid-row: 1; } .space-24 { grid-column: 7; grid-row: 1; } .space-25 { grid-column: 6; grid-row: 1; } .space-26 { grid-column: 5; grid-row: 1; } .space-27 { grid-column: 4; grid-row: 1; } .space-28 { grid-column: 3; grid-row: 1; } .space-29 { grid-column: 2; grid-row: 1; } .space-30 { grid-column: 1; grid-row: 1; }
        .space-31 { grid-column: 1; grid-row: 2; } .space-32 { grid-column: 1; grid-row: 3; } .space-33 { grid-column: 1; grid-row: 4; } .space-34 { grid-column: 1; grid-row: 5; } .space-35 { grid-column: 1; grid-row: 6; } .space-36 { grid-column: 1; grid-row: 7; } .space-37 { grid-column: 1; grid-row: 8; } .space-38 { grid-column: 1; grid-row: 9; } .space-39 { grid-column: 1; grid-row: 10; }
        
        .players-on-space { position: absolute; bottom: 1px; left: 1px; display: flex; gap: 2px; flex-wrap: wrap; }
        .player-token { width: 10px; height: 10px; border-radius: 50%; border: 1px solid white; }
        .rent-level { position: absolute; bottom: 8px; right: 1px; background: #ffd700; color: #000; width: 12px; height: 12px; border-radius: 2px; display: flex; align-items: center; justify-content: center; font-size: 0.5rem; font-weight: bold; }
        
        .side-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 700px;
            overflow-y: auto;
            width: 280px;
        }
        
        .section-title { font-weight: 700; color: #667eea; font-size: 0.95rem; margin-bottom: 10px; }
        
        .player-card {
            background: #f5f7fa;
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }
        .player-card.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateX(3px);
        }
        .player-name { font-weight: 700; margin-bottom: 3px; display: flex; align-items: center; gap: 6px; }
        .player-color-dot { width: 10px; height: 10px; border-radius: 50%; }
        .player-stat { display: flex; justify-content: space-between; font-size: 0.8rem; }
        
        .controls-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .dice-container { display: flex; gap: 8px; justify-content: center; }
        .dice { width: 40px; height: 40px; background: white; border: 2px solid #667eea; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; font-weight: bold; color: #667eea; }
        .dice.rolling { animation: roll 0.3s infinite; }
        @keyframes roll { 0%, 100% { transform: rotate(0deg); } 50% { transform: rotate(180deg); } }
        
        .total-roll { text-align: center; font-size: 0.9rem; font-weight: bold; color: #667eea; }
        
        button {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 100%;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(102, 126, 234, 0.3); }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            width: 100%;
        }
        .btn-secondary:hover { background: #e0e0e0; }
        
        .game-log {
            background: #f5f5f5;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            max-height: 120px;
            overflow-y: auto;
            border-left: 3px solid #667eea;
        }
        .log-entry { padding: 2px 0; line-height: 1.2; border-bottom: 1px solid #ddd; }
        .log-entry.info { color: #667eea; font-weight: 600; }
        .log-entry.success { color: #4ECDC4; }
        .log-entry.warning { color: #FF6B9D; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .modal-header { font-size: 1.4rem; font-weight: 700; color: #667eea; margin-bottom: 15px; }
        .modal-body { margin-bottom: 15px; color: #555; line-height: 1.5; font-size: 0.95rem; }
        .property-info { background: #f5f5f5; padding: 12px; border-radius: 8px; margin-bottom: 12px; }
        .property-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #ddd; font-size: 0.9rem; }
        
        .input-group { margin-bottom: 12px; }
        .input-group label { display: block; margin-bottom: 4px; font-weight: 600; color: #333; font-size: 0.9rem; }
        .input-group input, .input-group select { width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 5px; font-size: 0.9rem; }
        .input-group input:focus, .input-group select:focus { outline: none; border-color: #667eea; }
        
        .modal-footer { display: flex; gap: 8px; justify-content: flex-end; flex-wrap: wrap; }
        .modal-footer button { min-width: 90px; padding: 10px 15px; }
        
        .status-bar {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 1rem;
        }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 12px; border-bottom: 2px solid #eee; }
        .tab-btn { padding: 8px 12px; background: none; border: none; border-bottom: 3px solid transparent; color: #666; cursor: pointer; font-weight: 600; font-size: 0.9rem; }
        .tab-btn.active { color: #667eea; border-bottom-color: #667eea; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .property-item { background: #f5f5f5; padding: 8px; border-radius: 6px; border-left: 3px solid; cursor: pointer; font-size: 0.85rem; }
        .property-item:hover { background: #eee; }
        .property-item-name { font-weight: 700; }
        .property-item-info { font-size: 0.75rem; color: #666; margin-top: 2px; }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header" style="grid-column: 1 / -1;">
            <h1>üé© MONOPOLY ULTIMATE BANKING</h1>
            <p>Versi√≥n Digital</p>
        </div>

        <div class="status-bar">
            <span id="statusBar">üéÆ Esperando jugadores...</span>
        </div>

        <!-- PANEL IZQUIERDO -->
        <div class="side-panel">
            <div>
                <div class="section-title">üë• JUGADORES</div>
                <div id="playersContainer"></div>
            </div>

            <div class="controls-section">
                <button class="btn-primary" onclick="rollDice()">üé≤ DADOS</button>
                <div class="dice-container">
                    <div class="dice" id="dice1">-</div>
                    <div class="dice" id="dice2">-</div>
                </div>
                <div class="total-roll" id="totalRoll"></div>
                <button class="btn-secondary" onclick="newGame()">üîÑ NUEVO</button>
            </div>

            <div>
                <div class="section-title">üìã REGISTRO</div>
                <div class="game-log" id="gameLog"></div>
            </div>
        </div>

        <!-- TABLERO CENTRAL -->
        <div class="board-wrapper">
            <div class="monopoly-board" id="board"></div>
        </div>

        <!-- PANEL DERECHO -->
        <div class="side-panel">
            <div id="rightPanel"></div>
        </div>
    </div>

    <!-- MODAL SETUP -->
    <div class="modal" id="setupModal">
        <div class="modal-content">
            <div class="modal-header">üéÆ CONFIGURAR JUEGO</div>
            <div class="modal-body">
                <div class="input-group">
                    <label>¬øCu√°ntos jugadores? (2-4)</label>
                    <input type="number" id="playerCount" min="2" max="4" value="2">
                </div>
                <div id="playersSetup"></div>
                <div class="input-group">
                    <label>üí∞ Dinero inicial por jugador ($)</label>
                    <input type="number" id="initialMoney" min="100" value="500" step="50">
                </div>
                <div class="input-group">
                    <label>üè† ¬øRepartir propiedades al inicio?</label>
                    <select id="distributeProperties">
                        <option value="no">No</option>
                        <option value="yes">S√≠ (equitativo)</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="startGame()">Comenzar</button>
            </div>
        </div>
    </div>

    <!-- MODAL PROPIEDAD -->
    <div class="modal" id="propertyModal">
        <div class="modal-content">
            <div class="modal-header" id="propertyTitle"></div>
            <div class="modal-body" id="propertyInfo"></div>
            <div class="modal-footer">
                <button class="btn-primary" id="buyBtn" onclick="buyProperty()">üí∞ Comprar</button>
                <button class="btn-primary" id="auctionBtn" onclick="showAuctionModal()" style="background: linear-gradient(135deg, #ffa500, #ff6b6b);">üî® Subasta</button>
                <button class="btn-secondary" onclick="closePropertyModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- MODAL SUBASTA MEJORADO -->
    <div class="modal" id="auctionModal">
        <div class="modal-content">
            <div class="modal-header">üî® SUBASTA</div>
            <div style="background: #fff3cd; padding: 10px; border-radius: 8px; margin-bottom: 12px;">
                <h3 id="auctionPropertyName" style="color: #856404; margin-bottom: 8px; font-size: 1rem;"></h3>
                <div style="font-size: 0.9rem; color: #856404;">
                    <div><strong>Precio de salida:</strong> $20</div>
                    <div id="auctionCurrentBid" style="margin-top: 5px; font-size: 1.1rem; font-weight: bold;">Puja actual: $20</div>
                </div>
            </div>

            <div class="input-group">
                <label>üéÆ ¬øQui√©n puja?</label>
                <select id="auctionPlayerSelect" style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 5px; font-size: 0.9rem;">
                    <option value="">-- Selecciona jugador --</option>
                </select>
            </div>

            <div style="background: #f5f5f5; padding: 10px; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid #667eea;">
                <div style="font-weight: 700; margin-bottom: 8px; color: #667eea;">üìä Historial de Pujas:</div>
                <div id="auctionBidsContainer" style="max-height: 150px; overflow-y: auto;">
                    <p style="color: #999; text-align: center; font-size: 0.85rem;">Sin pujas a√∫n...</p>
                </div>
            </div>

            <div style="background: #f0f0f0; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                <div style="margin-bottom: 10px;">
                    <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">üí∞ <strong id="auctionNextBid">Siguiente puja: $40</strong></div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <button class="btn-primary" onclick="increaseBid()" style="background: linear-gradient(135deg, #4CAF50, #45a049);">‚¨ÜÔ∏è +$20</button>
                    <button class="btn-primary" onclick="increaseBid()" style="background: linear-gradient(135deg, #4CAF50, #45a049);">‚¨ÜÔ∏è +$20</button>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-primary" onclick="confirmBid()" style="flex: 1;">‚úÖ Confirmar</button>
                <button class="btn-secondary" onclick="withdrawBid()" style="flex: 1;">‚ùå Retirarse</button>
                <button class="btn-secondary" onclick="finishAuction()" style="flex: 1;">üèÅ Finalizar</button>
            </div>
        </div>
    </div>

    <!-- MODAL C√ÅRCEL -->
    <div class="modal" id="jailModal">
        <div class="modal-content">
            <div class="modal-header" style="color: #FF6B6B;">üö® ¬°C√ÅRCEL!</div>
            <div class="modal-body">
                <p>¬øC√≥mo quieres salir?</p>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="payJailFine()" style="flex: 1;">üí∞ Pagar $100</button>
                <button class="btn-primary" onclick="rollForJail()" style="flex: 1; background: linear-gradient(135deg, #4CAF50, #45a049);">üé≤ Tirar Dados</button>
            </div>
        </div>
    </div>
    <div class="modal" id="eventModal">
        <div class="modal-content">
            <div style="background: #87ceeb; color: white; padding: 10px; border-radius: 8px; margin-bottom: 12px; font-weight: 600; text-align: center;" id="eventTitle"></div>
            <div class="modal-body" id="eventBody"></div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="closeEventModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- MODAL UBICACI√ìN -->
    <div class="modal" id="locationModal">
        <div class="modal-content">
            <div class="modal-header">‚úàÔ∏è UBICACI√ìN</div>
            <div class="modal-body" style="margin-bottom: 12px;">Viaja a cualquier propiedad por $5</div>
            <div id="locationOptions" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px;"></div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeLocationModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- MODAL PERFIL -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <div class="modal-header" id="profileTitle"></div>
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('stats')">üìä Stats</button>
                <button class="tab-btn" onclick="switchTab('properties')">üè† Props</button>
            </div>
            <div class="tab-content active" id="statsTab"></div>
            <div class="tab-content" id="propertiesTab"></div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeProfileModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        const properties = [
            { id: 0, name: 'SALIDA', type: 'corner', price: 0, position: 0 },
            { id: 1, name: 'Mediterr√°nea', type: 'property', price: 60, color: 'brown', position: 1, baseRent: [2, 6, 18, 30, 90, 160] },
            { id: 2, name: 'Evento', type: 'event', price: 0, position: 2 },
            { id: 3, name: 'B√°ltica', type: 'property', price: 60, color: 'brown', position: 3, baseRent: [4, 12, 36, 60, 180, 320] },
            { id: 4, name: 'Impuesto', type: 'tax', price: 200, position: 4 },
            { id: 5, name: 'Ferrocarril 1', type: 'railroad', price: 200, position: 5 },
            { id: 6, name: 'Oriental', type: 'property', price: 100, color: 'lightblue', position: 6, baseRent: [6, 18, 54, 90, 270, 450] },
            { id: 7, name: 'Ubicaci√≥n', type: 'location', price: 5, position: 7 },
            { id: 8, name: 'Vermont', type: 'property', price: 100, color: 'lightblue', position: 8, baseRent: [6, 18, 54, 90, 270, 450] },
            { id: 9, name: 'Connecticut', type: 'property', price: 120, color: 'lightblue', position: 9, baseRent: [8, 24, 72, 120, 360, 600] },
            { id: 10, name: 'C√ÅRCEL', type: 'corner', price: 0, position: 10 },
            { id: 11, name: 'St. Charles', type: 'property', price: 140, color: 'pink', position: 11, baseRent: [10, 30, 90, 160, 480, 750] },
            { id: 12, name: 'Electricidad', type: 'utility', price: 150, position: 12 },
            { id: 13, name: 'Estados', type: 'property', price: 140, color: 'pink', position: 13, baseRent: [10, 30, 90, 160, 480, 750] },
            { id: 14, name: 'Virginia', type: 'property', price: 160, color: 'pink', position: 14, baseRent: [12, 36, 108, 180, 540, 900] },
            { id: 15, name: 'Ferrocarril 2', type: 'railroad', price: 200, position: 15 },
            { id: 16, name: 'St. James', type: 'property', price: 180, color: 'orange', position: 16, baseRent: [14, 42, 126, 210, 630, 1100] },
            { id: 17, name: 'Evento', type: 'event', price: 0, position: 17 },
            { id: 18, name: 'Tennessee', type: 'property', price: 180, color: 'orange', position: 18, baseRent: [14, 42, 126, 210, 630, 1100] },
            { id: 19, name: 'Nueva York', type: 'property', price: 200, color: 'orange', position: 19, baseRent: [16, 48, 144, 240, 720, 1275] },
            { id: 20, name: 'ESTACIONAMIENTO', type: 'corner', price: 0, position: 20 },
            { id: 21, name: 'Kentucky', type: 'property', price: 220, color: 'red', position: 21, baseRent: [18, 54, 162, 270, 810, 1400] },
            { id: 22, name: 'Ubicaci√≥n', type: 'location', price: 5, position: 22 },
            { id: 23, name: 'Indiana', type: 'property', price: 220, color: 'red', position: 23, baseRent: [18, 54, 162, 270, 810, 1400] },
            { id: 24, name: 'Illinois', type: 'property', price: 240, color: 'red', position: 24, baseRent: [20, 60, 180, 300, 900, 1550] },
            { id: 25, name: 'Ferrocarril 3', type: 'railroad', price: 200, position: 25 },
            { id: 26, name: 'Atlantic', type: 'property', price: 260, color: 'yellow', position: 26, baseRent: [22, 66, 198, 330, 990, 1700] },
            { id: 27, name: 'Ventnor', type: 'property', price: 260, color: 'yellow', position: 27, baseRent: [22, 66, 198, 330, 990, 1700] },
            { id: 28, name: 'Agua', type: 'utility', price: 150, position: 28 },
            { id: 29, name: 'Marvin Gardens', type: 'property', price: 280, color: 'yellow', position: 29, baseRent: [24, 72, 216, 360, 1080, 1900] },
            { id: 30, name: 'VE A C√ÅRCEL', type: 'corner', price: 0, position: 30 },
            { id: 31, name: 'Pacific', type: 'property', price: 300, color: 'green', position: 31, baseRent: [26, 78, 234, 390, 1170, 2000] },
            { id: 32, name: 'Evento', type: 'event', price: 0, position: 32 },
            { id: 33, name: 'Carolina N', type: 'property', price: 300, color: 'green', position: 33, baseRent: [26, 78, 234, 390, 1170, 2000] },
            { id: 34, name: 'Pensilvania', type: 'property', price: 320, color: 'green', position: 34, baseRent: [28, 84, 252, 420, 1260, 2150] },
            { id: 35, name: 'Ferrocarril 4', type: 'railroad', price: 200, position: 35 },
            { id: 36, name: 'Ubicaci√≥n', type: 'location', price: 5, position: 36 },
            { id: 37, name: 'Park Place', type: 'property', price: 350, color: 'darkblue', position: 37, baseRent: [35, 105, 315, 525, 1575, 2100] },
            { id: 38, name: 'Lujo', type: 'tax', price: 100, position: 38 },
            { id: 39, name: 'Paseo Mar√≠timo', type: 'property', price: 400, color: 'darkblue', position: 39, baseRent: [50, 150, 450, 625, 750, 1000] }
        ];

        const playerColors = ['#FF6B6B', '#4ECDC4', '#FFD93D', '#6BCB77'];
        const eventCards = [
            { text: 'üí∞ ¬°El mercado SUBE! +1 Nivel todas tus propiedades', action: (p, g) => {
                g.players.forEach(pl => {
                    pl.properties.forEach(propId => {
                        const prop = properties[propId];
                        if (prop.owner === pl.id && prop.type === 'property') {
                            prop.rentLevel = Math.min(5, (prop.rentLevel || 1) + 1);
                        }
                    });
                });
            }},
            { text: 'üìà ¬°BOOM! Todas las propiedades suben de nivel', action: (p, g) => {
                g.players.forEach(pl => {
                    pl.properties.forEach(propId => {
                        const prop = properties[propId];
                        if (prop.owner === pl.id && prop.type === 'property') {
                            prop.rentLevel = Math.min(5, (prop.rentLevel || 1) + 1);
                        }
                    });
                });
            }},
            { text: 'üöÄ ¬°Revaluaci√≥n de mercado! +1 Nivel a todos', action: (p, g) => {
                g.players.forEach(pl => {
                    pl.properties.forEach(propId => {
                        const prop = properties[propId];
                        if (prop.owner === pl.id && prop.type === 'property') {
                            prop.rentLevel = Math.min(5, (prop.rentLevel || 1) + 1);
                        }
                    });
                });
            }},
            { text: 'üìâ ¬°El mercado BAJA! -1 Nivel todos', action: (p, g) => {
                g.players.forEach(pl => {
                    pl.properties.forEach(propId => {
                        const prop = properties[propId];
                        if (prop.owner === pl.id && prop.type === 'property') {
                            prop.rentLevel = Math.max(1, (prop.rentLevel || 1) - 1);
                        }
                    });
                });
            }},
            { text: 'üíµ ¬°Bonificaci√≥n! +$150', action: (p) => { p.money += 150; } },
            { text: 'üí∏ Paga mantenimiento. -$150', action: (p) => { p.money -= 150; } },
            { text: 'üéâ ¬°Todos te pagan $50!', action: (p, g) => { g.players.forEach(pl => { if (pl.id !== p.id) { pl.money -= 50; p.money += 50; } }); } },
        ];

        let game = {
            players: [],
            currentPlayerIndex: 0,
            isRolling: false,
            dice1: 0,
            dice2: 0,
            gameStarted: false,
            initialMoney: 500,
            auctionActive: false,
            auctionProperty: null,
            auctionBids: {},
            auctionCurrentBid: 20,
            auctionTempBid: 0,
            auctionCurrentPlayer: null,
        };

        function init() {
            renderBoard();
            showSetupModal();
        }

        function showSetupModal() {
            const playerCountInput = document.getElementById('playerCount');
            const playersSetup = document.getElementById('playersSetup');
            playerCountInput.addEventListener('change', () => {
                const count = parseInt(playerCountInput.value);
                playersSetup.innerHTML = '';
                for (let i = 0; i < count; i++) {
                    playersSetup.innerHTML += `<div class="input-group"><label>Jugador ${i + 1}</label><input type="text" id="playerName${i}" value="Jugador ${i + 1}"></div>`;
                }
            });
            playerCountInput.dispatchEvent(new Event('change'));
            document.getElementById('setupModal').classList.add('active');
        }

        function startGame() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            const initialMoney = parseInt(document.getElementById('initialMoney').value);
            const distribute = document.getElementById('distributeProperties').value === 'yes';
            
            game.initialMoney = initialMoney;
            game.players = [];
            for (let i = 0; i < playerCount; i++) {
                const name = document.getElementById(`playerName${i}`).value;
                game.players.push({
                    id: i,
                    name: name,
                    money: initialMoney,
                    position: 0,
                    properties: [],
                    color: playerColors[i],
                    inJail: false,
                    jailTurns: 0,
                    bankrupt: false
                });
            }
            
            // Repartir propiedades equitativamente si est√° habilitado
            if (distribute) {
                distributePropertiesEquitably();
            }
            
            game.gameStarted = true;
            document.getElementById('setupModal').classList.remove('active');
            updateUI();
            addLog(`¬°Juego iniciado! $${initialMoney} cada uno`, 'info');
            if (distribute) {
                addLog(`üè† Propiedades repartidas equitativamente`, 'success');
            }
        }

        function distributePropertiesEquitably() {
            const ownableProperties = properties.filter(p => p.type === 'property' || p.type === 'railroad' || p.type === 'utility');
            let playerIndex = 0;
            
            ownableProperties.forEach((prop, idx) => {
                const player = game.players[playerIndex];
                prop.owner = player.id;
                prop.rentLevel = 1;
                player.properties.push(prop.id);
                player.money -= prop.price;
                
                playerIndex = (playerIndex + 1) % game.players.length;
            });
        }

        function renderBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            properties.forEach((prop) => {
                const space = document.createElement('div');
                space.className = `board-space space-${prop.position}`;
                space.id = `space-${prop.position}`;
                
                if (prop.type === 'corner') space.classList.add('corner-space');
                else if (prop.type === 'property') space.classList.add('street-property', prop.color);
                else if (prop.type === 'railroad') space.classList.add('railroad');
                else if (prop.type === 'utility') space.classList.add('utility');
                else if (prop.type === 'event') space.classList.add('event-space');
                else if (prop.type === 'location') space.classList.add('location-space');

                space.innerHTML = `<span>${prop.name}</span><div class="players-on-space" id="players-${prop.position}"></div><div class="rent-level" id="rentLevel-${prop.position}"></div>`;
                space.addEventListener('click', () => {
                    if ((prop.type === 'property' || prop.type === 'railroad' || prop.type === 'utility') && !game.auctionActive) showPropertyModal(prop);
                });
                board.appendChild(space);
            });
        }

        function rollDice() {
            if (game.isRolling || !game.gameStarted) return;
            const player = getCurrentPlayer();
            if (player.inJail && player.jailTurns > 0) {
                player.jailTurns--;
                addLog(`${player.name} en c√°rcel (${player.jailTurns})`, 'warning');
                setTimeout(() => endTurn(), 1500);
                return;
            }
            if (player.inJail) player.inJail = false;

            game.isRolling = true;
            const d1 = document.getElementById('dice1');
            const d2 = document.getElementById('dice2');
            d1.classList.add('rolling');
            d2.classList.add('rolling');

            setTimeout(() => {
                game.dice1 = Math.floor(Math.random() * 6) + 1;
                game.dice2 = Math.floor(Math.random() * 6) + 1;
                d1.classList.remove('rolling');
                d2.classList.remove('rolling');
                d1.textContent = game.dice1;
                d2.textContent = game.dice2;
                document.getElementById('totalRoll').textContent = `${game.dice1 + game.dice2}`;
                movePlayer(game.dice1 + game.dice2);
                if (game.dice1 === game.dice2) {
                    addLog(`${player.name} DOBLES! üé≤`, 'success');
                    game.isRolling = false;
                } else {
                    setTimeout(() => endTurn(), 2500);
                }
                updateUI();
            }, 300);
        }

        function movePlayer(steps) {
            const player = getCurrentPlayer();
            const oldPos = player.position;
            player.position = (player.position + steps) % 40;
            if (player.position < oldPos) {
                player.money += 200;
                addLog(`${player.name} SALIDA +$200`, 'success');
            }
            updatePlayerPositions();
            checkSpace(player.position);
        }

        function checkSpace(position) {
            const prop = properties[position];
            const player = getCurrentPlayer();
            switch (prop.type) {
                case 'property':
                case 'railroad':
                case 'utility':
                    if (prop.owner !== undefined) {
                        if (prop.owner !== player.id) payRent(player, prop);
                    } else {
                        showPropertyModal(prop);
                    }
                    break;
                case 'tax':
                    player.money -= prop.price;
                    addLog(`${player.name} Impuesto -$${prop.price}`, 'warning');
                    break;
                case 'event':
                    drawEvent(player);
                    break;
                case 'location':
                    showLocationModal();
                    break;
                case 'corner':
                    if (position === 30) {
                        showJailModal();
                    }
                    break;
            }
        }

        function showJailModal() {
            addLog(`${getCurrentPlayer().name} ¬°A la C√ÅRCEL!`, 'warning');
            document.getElementById('jailModal').classList.add('active');
        }

        function payJailFine() {
            const player = getCurrentPlayer();
            if (player.money >= 100) {
                player.money -= 100;
                player.inJail = false;
                addLog(`${player.name} pag√≥ $100 y sali√≥ de c√°rcel`, 'success');
                document.getElementById('jailModal').classList.remove('active');
                updateUI();
                setTimeout(() => endTurn(), 2000);
            } else {
                alert('‚ùå No tienes $100');
            }
        }

        function rollForJail() {
            const player = getCurrentPlayer();
            const d1 = Math.floor(Math.random() * 6) + 1;
            const d2 = Math.floor(Math.random() * 6) + 1;
            
            if (d1 === d2) {
                player.inJail = false;
                addLog(`${player.name} sac√≥ DOBLES y sali√≥ de c√°rcel! üé≤`, 'success');
                document.getElementById('jailModal').classList.remove('active');
                updateUI();
                setTimeout(() => { 
                    movePlayer(d1 + d2);
                    checkSpace(player.position);
                    if (d1 === d2) {
                        game.isRolling = false;
                    } else {
                        setTimeout(() => endTurn(), 2500);
                    }
                }, 2000);
            } else {
                player.inJail = true;
                player.jailTurns = 3;
                addLog(`${player.name} no sac√≥ dobles y entra a c√°rcel (3 turnos)`, 'warning');
                document.getElementById('jailModal').classList.remove('active');
                updateUI();
                setTimeout(() => endTurn(), 2000);
            }
        }

        function drawEvent(player) {
            const card = eventCards[Math.floor(Math.random() * eventCards.length)];
            showEventModal('üé∞ EVENTO', card.text);
            card.action(player, game);
            updateUI();
        }

        function payRent(player, prop) {
            const owner = game.players[prop.owner];
            const level = prop.rentLevel || 1;
            let rent = 0;
            if (prop.type === 'property') {
                rent = prop.baseRent[level - 1] || prop.baseRent[0];
            } else if (prop.type === 'railroad') {
                const owned = owner.properties.filter(id => properties[id].type === 'railroad').length;
                rent = 50 * Math.pow(2, Math.min(owned - 1, 3));
            } else if (prop.type === 'utility') {
                // 10% del dinero total que tiene el jugador
                rent = Math.floor(player.money * 0.15);
            }
            if (player.money < rent) {
                player.money = 0;
                player.bankrupt = true;
                addLog(`${player.name} BANCARROTA!`, 'warning');
            } else {
                player.money -= rent;
                owner.money += rent;
                addLog(`${player.name} paga $${rent} a ${owner.name}`, 'warning');
            }
            // ‚ö° SUBE EL NIVEL DESPU√âS DE PAGAR
            if (prop.type === 'property') {
                prop.rentLevel = Math.min(5, (prop.rentLevel || 1) + 1);
                addLog(`üìà ${prop.name} NIVEL ${prop.rentLevel}!`, 'success');
            }
        }

        function showPropertyModal(prop) {
            if (!game.gameStarted) return;
            const player = getCurrentPlayer();
            document.getElementById('propertyTitle').textContent = prop.name;
            let html = `<div class="property-info">`;
            html += `<div class="property-row"><span>Precio:</span><strong>$${prop.price}</strong></div>`;
            if (prop.owner === undefined) {
                html += `<div class="property-row"><span>Estado:</span><strong style="color: green;">DISPONIBLE</strong></div>`;
            } else {
                html += `<div class="property-row"><span>Due√±o:</span><strong style="cursor: pointer; color: #667eea;" onclick="showProfile(${prop.owner})">${game.players[prop.owner].name}</strong></div>`;
                const level = prop.rentLevel || 1;
                html += `<div class="property-row"><span>Nivel:</span><strong>${level}/5</strong></div>`;
            }
            html += `<div class="property-row"><span>Tu dinero:</span><strong>$${player.money}</strong></div>`;
            if (prop.baseRent) {
                html += `<div style="margin-top: 8px; font-size: 0.8rem;"><strong>Renta:</strong>`;
                prop.baseRent.forEach((r, i) => {
                    html += `<div>Lv${i+1}: $${r}</div>`;
                });
                html += `</div>`;
            }
            html += `</div>`;
            document.getElementById('propertyInfo').innerHTML = html;
            const buyBtn = document.getElementById('buyBtn');
            const auctionBtn = document.getElementById('auctionBtn');
            if (prop.owner === undefined) {
                buyBtn.style.display = player.money >= prop.price ? 'inline-block' : 'none';
                auctionBtn.style.display = 'inline-block';
            } else {
                buyBtn.style.display = 'none';
                auctionBtn.style.display = 'none';
            }
            window.selectedProperty = prop;
            document.getElementById('propertyModal').classList.add('active');
        }

        function buyProperty(prop = window.selectedProperty) {
            const player = getCurrentPlayer();
            if (player.money >= prop.price) {
                player.money -= prop.price;
                prop.owner = player.id;
                prop.rentLevel = 1;
                player.properties.push(prop.id);
                addLog(`${player.name} compr√≥ ${prop.name}`, 'success');
                closePropertyModal();
                updateUI();
            }
        }

        function showAuctionModal(prop = window.selectedProperty) {
            closePropertyModal();
            game.auctionActive = true;
            game.auctionProperty = prop;
            game.auctionBids = {};
            game.auctionCurrentBid = 20;
            game.auctionTempBid = 0;
            game.auctionCurrentPlayer = null;
            
            document.getElementById('auctionPropertyName').textContent = prop.name;
            document.getElementById('auctionCurrentBid').textContent = `Puja actual: $${game.auctionCurrentBid}`;
            document.getElementById('auctionNextBid').textContent = `Siguiente puja: $${game.auctionCurrentBid + 20}`;
            
            const select = document.getElementById('auctionPlayerSelect');
            select.innerHTML = '<option value="">-- Selecciona jugador --</option>';
            game.players.forEach((p, i) => {
                if (!p.bankrupt) {
                    const opt = document.createElement('option');
                    opt.value = i;
                    opt.textContent = p.name;
                    select.appendChild(opt);
                }
            });
            
            document.getElementById('auctionBidsContainer').innerHTML = '<p style="color: #999; text-align: center; font-size: 0.85rem;">Sin pujas a√∫n...</p>';
            document.getElementById('auctionModal').classList.add('active');
            addLog(`üî® SUBASTA: ${prop.name}`, 'info');
        }

        function increaseBid() {
            const select = document.getElementById('auctionPlayerSelect');
            if (select.value === '') {
                alert('‚ùå Selecciona un jugador primero');
                return;
            }
            
            const playerId = parseInt(select.value);
            const player = game.players[playerId];
            const nextBid = game.auctionCurrentBid + 20;
            
            if (player.money < nextBid) {
                alert(`‚ùå ${player.name} no tiene suficiente dinero ($${nextBid})`);
                return;
            }
            
            game.auctionCurrentPlayer = playerId;
            game.auctionTempBid = nextBid;
            
            document.getElementById('auctionNextBid').textContent = `Siguiente puja: $${nextBid + 20}`;
            select.style.borderColor = '#4CAF50';
            select.style.backgroundColor = '#e8f5e9';
            
            addLog(`${player.name} intenta pujar $${nextBid}`, 'info');
        }

        function confirmBid() {
            if (game.auctionCurrentPlayer === null) {
                alert('‚ùå Debes aumentar la puja primero');
                return;
            }
            
            const player = game.players[game.auctionCurrentPlayer];
            game.auctionCurrentBid = game.auctionTempBid;
            game.auctionBids[game.auctionCurrentPlayer] = game.auctionCurrentBid;
            
            document.getElementById('auctionCurrentBid').textContent = `Puja actual: $${game.auctionCurrentBid}`;
            document.getElementById('auctionNextBid').textContent = `Siguiente puja: $${game.auctionCurrentBid + 20}`;
            
            const select = document.getElementById('auctionPlayerSelect');
            select.value = '';
            select.style.borderColor = '#ddd';
            select.style.backgroundColor = 'white';
            game.auctionCurrentPlayer = null;
            game.auctionTempBid = 0;
            
            updateAuctionDisplay();
            addLog(`‚úÖ ${player.name} pujo $${game.auctionCurrentBid}`, 'success');
        }

        function updateAuctionDisplay() {
            const container = document.getElementById('auctionBidsContainer');
            container.innerHTML = '';
            const sortedBids = Object.entries(game.auctionBids).sort((a, b) => b[1] - a[1]);
            
            if (sortedBids.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center; font-size: 0.85rem;">Sin pujas a√∫n...</p>';
                return;
            }
            
            sortedBids.forEach(([pid, bid], idx) => {
                const d = document.createElement('div');
                d.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #ddd; font-size: 0.9rem; background: ' + (idx === 0 ? '#fff9c4' : 'transparent');
                const medal = idx === 0 ? 'ü•á' : (idx === 1 ? 'ü•à' : 'ü•â');
                d.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span>${medal}</span>
                        <strong>${game.players[pid].name}</strong>
                    </div>
                    <strong style="color: #4CAF50; font-size: 1rem;">$${bid}</strong>
                `;
                container.appendChild(d);
            });
        }

        function withdrawBid() {
            const select = document.getElementById('auctionPlayerSelect');
            if (select.value === '') {
                alert('‚ùå Selecciona un jugador para retirarse');
                return;
            }
            
            const playerId = parseInt(select.value);
            delete game.auctionBids[playerId];
            
            select.value = '';
            select.style.borderColor = '#ddd';
            select.style.backgroundColor = 'white';
            game.auctionCurrentPlayer = null;
            game.auctionTempBid = 0;
            
            updateAuctionDisplay();
            addLog(`${game.players[playerId].name} se retir√≥ de la subasta`, 'warning');
        }

        function finishAuction() {
            const prop = game.auctionProperty;
            let winner = null, maxBid = 0;
            Object.entries(game.auctionBids).forEach(([pid, bid]) => {
                if (bid > maxBid) {
                    maxBid = bid;
                    winner = parseInt(pid);
                }
            });
            if (winner !== null) {
                const w = game.players[winner];
                w.money -= maxBid;
                prop.owner = winner;
                prop.rentLevel = 1;
                w.properties.push(prop.id);
                addLog(`üî® ${w.name} gan√≥ la subasta por $${maxBid}`, 'success');
            } else {
                addLog(`‚ùå La subasta fue cancelada (sin pujas)`, 'warning');
            }
            game.auctionActive = false;
            game.auctionBids = {};
            game.auctionCurrentBid = 20;
            document.getElementById('auctionModal').classList.remove('active');
            updateUI();
        }

        function showLocationModal() {
            const container = document.getElementById('locationOptions');
            container.innerHTML = '';
            properties.filter(p => p.type === 'property').forEach(prop => {
                const btn = document.createElement('button');
                btn.className = 'btn-secondary';
                btn.style.fontSize = '0.8rem';
                btn.textContent = prop.name.substring(0, 12);
                btn.onclick = () => {
                    const p = getCurrentPlayer();
                    if (p.money >= 5) {
                        p.money -= 5;
                        p.position = prop.position;
                        addLog(`${p.name} viaj√≥ a ${prop.name}`, 'success');
                        closeLocationModal();
                        checkSpace(prop.position);
                        updateUI();
                    }
                };
                container.appendChild(btn);
            });
            document.getElementById('locationModal').classList.add('active');
        }

        function showProfile(playerId) {
            const p = game.players[playerId];
            const propVal = p.properties.reduce((s, id) => s + properties[id].price, 0);
            const total = p.money + propVal;
            
            document.getElementById('profileTitle').textContent = `üë§ ${p.name}`;
            document.getElementById('statsTab').innerHTML = `
                <div class="property-info">
                    <div class="property-row"><span>Dinero</span><strong style="color: #4ECDC4;">$${p.money}</strong></div>
                    <div class="property-row"><span>Propiedades</span><strong>${p.properties.length}</strong></div>
                    <div class="property-row"><span>Valor Props</span><strong>$${propVal}</strong></div>
                    <div class="property-row"><span style="font-weight: 700;">TOTAL</span><strong style="color: #FFD93D; font-size: 1.1rem;">$${total}</strong></div>
                </div>
            `;
            
            let propsHtml = '';
            p.properties.forEach(pid => {
                const prop = properties[pid];
                const level = prop.rentLevel || 1;
                propsHtml += `
                    <div class="property-item" style="border-left-color: ${prop.color || '#667eea'};">
                        <div class="property-item-name">${prop.name}</div>
                        <div class="property-item-info">Nivel ${level}/5 | Renta: $${prop.baseRent ? prop.baseRent[level-1] : 'N/A'}</div>
                    </div>
                `;
            });
            document.getElementById('propertiesTab').innerHTML = propsHtml || '<p style="color: #999;">Sin propiedades</p>';
            document.getElementById('profileModal').classList.add('active');
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        function closePropertyModal() { document.getElementById('propertyModal').classList.remove('active'); }
        function closeLocationModal() { document.getElementById('locationModal').classList.remove('active'); }
        function closeProfileModal() { document.getElementById('profileModal').classList.remove('active'); }
        function showEventModal(title, msg) {
            document.getElementById('eventTitle').textContent = title;
            document.getElementById('eventBody').textContent = msg;
            document.getElementById('eventModal').classList.add('active');
        }
        function closeEventModal() { document.getElementById('eventModal').classList.remove('active'); }

        function getCurrentPlayer() { return game.players[game.currentPlayerIndex]; }
        function endTurn() {
            const activos = game.players.filter(p => !p.bankrupt).length;
            if (activos === 1) {
                const winner = game.players.find(p => !p.bankrupt);
                addLog(`¬°¬°¬°${winner.name} GAN√ì!!! üéâ`, 'success');
                return;
            }
            let nextIdx = (game.currentPlayerIndex + 1) % game.players.length;
            while (game.players[nextIdx].bankrupt) {
                nextIdx = (nextIdx + 1) % game.players.length;
            }
            game.currentPlayerIndex = nextIdx;
            game.dice1 = 0;
            game.dice2 = 0;
            document.getElementById('dice1').textContent = '-';
            document.getElementById('dice2').textContent = '-';
            document.getElementById('totalRoll').textContent = '';
            game.isRolling = false;
            updateUI();
        }

        function updateUI() {
            updateStatusBar();
            updatePlayersList();
            updatePlayerPositions();
            updateRentLevels();
            updateRightPanel();
        }

        function updateStatusBar() {
            const p = getCurrentPlayer();
            document.getElementById('statusBar').textContent = `üéÆ ${p.name}${p.inJail ? ' (C√ÅRCEL)' : ''} | üí∞ $${p.money}`;
        }

        function updatePlayersList() {
            const container = document.getElementById('playersContainer');
            container.innerHTML = '';
            game.players.forEach((p, i) => {
                const card = document.createElement('div');
                card.className = 'player-card' + (i === game.currentPlayerIndex && !p.bankrupt ? ' active' : '');
                card.style.borderLeftColor = p.color;
                card.onclick = () => showProfile(i);
                card.innerHTML = `
                    <div class="player-name">
                        <div class="player-color-dot" style="background: ${p.color};"></div>
                        <span>${p.name}</span>
                    </div>
                    ${p.bankrupt ? '<span style="color: #FF6B6B; font-weight: 700;">üíî BANCARROTA</span>' : `
                        <div class="player-stat"><span>üí∞</span><span>$${p.money}</span></div>
                        <div class="player-stat"><span>üè†</span><span>${p.properties.length}</span></div>
                    `}
                `;
                container.appendChild(card);
            });
        }

        function updatePlayerPositions() {
            document.querySelectorAll('.players-on-space').forEach(e => e.innerHTML = '');
            game.players.forEach(p => {
                if (p.bankrupt) return;
                const el = document.getElementById(`players-${p.position}`);
                if (el) {
                    const token = document.createElement('div');
                    token.className = 'player-token';
                    token.style.background = p.color;
                    el.appendChild(token);
                }
            });
        }

        function updateRentLevels() {
            properties.forEach(p => {
                if (p.type === 'property' && p.owner !== undefined) {
                    const el = document.getElementById(`rentLevel-${p.position}`);
                    if (el) {
                        el.textContent = `${p.rentLevel || 1}`;
                        el.style.display = 'flex';
                    }
                }
            });
        }

        function updateRightPanel() {
            const panel = document.getElementById('rightPanel');
            if (!game.gameStarted) {
                panel.innerHTML = '<p style="color: #999; text-align: center;">Esperando...</p>';
                return;
            }
            const p = getCurrentPlayer();
            const propVal = p.properties.reduce((s, id) => s + properties[id].price, 0);
            panel.innerHTML = `
                <div>
                    <div class="section-title">üíé VALOR</div>
                    <div class="property-info" style="padding: 10px;">
                        <div class="property-row"><span>Dinero</span><strong>$${p.money}</strong></div>
                        <div class="property-row"><span>Propiedades</span><strong>$${propVal}</strong></div>
                        <div class="property-row"><span style="font-weight: 700;">TOTAL</span><strong style="color: #FFD93D;">$${p.money + propVal}</strong></div>
                    </div>
                </div>
                <div>
                    <div class="section-title">üè† MIS PROPIEDADES (${p.properties.length})</div>
                    <div style="display: grid; gap: 6px; max-height: 200px; overflow-y: auto;">
                        ${p.properties.map(id => {
                            const prop = properties[id];
                            const level = prop.rentLevel || 1;
                            return `<div class="property-item" style="border-left-color: ${prop.color || '#667eea'}; font-size: 0.8rem;">
                                <div class="property-item-name">${prop.name}</div>
                                <div class="property-item-info">Nivel ${level}/5</div>
                            </div>`;
                        }).join('') || '<p style="color: #999; font-size: 0.85rem;">Ninguna</p>'}
                    </div>
                </div>
            `;
        }

        function addLog(msg, type = 'info') {
            const log = document.getElementById('gameLog');
            const e = document.createElement('div');
            e.className = `log-entry ${type}`;
            e.textContent = msg;
            log.insertBefore(e, log.firstChild);
            while (log.children.length > 20) log.removeChild(log.lastChild);
        }

        function newGame() {
            if (confirm('¬øNuevo juego?')) location.reload();
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
